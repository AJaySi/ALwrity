"""
Logger Configuration Module - Consolidated into Unified Logging System
Handles clean logging setup for end users using the unified logging system.
"""

import os
import logging
from loguru import logger

# Use unified logger for consistent logging
unified_logger = logger.bind(service="logging_config")


def setup_clean_logging():
    """Set up clean logging for end users using unified system."""
    verbose_mode = os.getenv("ALWRITY_VERBOSE", "false").lower() == "true"
    
    # Always remove all existing handlers first to prevent conflicts
    try:
        unified_logger.remove()  # Remove default handler (no parameters needed)
    except Exception as e:
        # If remove fails, continue anyway
        if verbose_mode:
            print(f"⚠️  Warning: Could not remove logger handlers: {e}")
    
    if not verbose_mode:
        # Suppress verbose logging for end users - be more aggressive
        logging.getLogger('sqlalchemy.engine').setLevel(logging.CRITICAL)
        logging.getLogger('sqlalchemy.pool').setLevel(logging.CRITICAL)
        logging.getLogger('sqlalchemy.dialects').setLevel(logging.CRITICAL)
        logging.getLogger('sqlalchemy.orm').setLevel(logging.CRITICAL)
        logging.getLogger('sqlalchemy').setLevel(logging.CRITICAL)
        logging.getLogger('sqlalchemy.engine.Engine').setLevel(logging.CRITICAL)
        
        # Suppress service initialization logs
        logging.getLogger('services').setLevel(logging.WARNING)
        logging.getLogger('api').setLevel(logging.WARNING)
        logging.getLogger('models').setLevel(logging.WARNING)
        
        # Suppress specific noisy loggers
        noisy_loggers = [
            'linkedin_persona_service',
            'facebook_persona_service', 
            'core_persona_service',
            'persona_analysis_service',
            'ai_service_manager',
            'ai_engine_service',
            'website_analyzer',
            'competitor_analyzer',
            'keyword_researcher',
            'content_gap_analyzer',
            'onboarding_data_service',
            'comprehensive_user_data',
            'strategy_data',
            'gap_analysis_data',
            'phase1_steps',
            'phase2_steps',
            'phase3_steps',
            'phase4_steps',
            'phase5_steps',
            'phase6_steps',
            'phase7_steps',
            'phase8_steps',
            'phase9_steps',
            'phase10_steps',
            'phase11_steps',
            'phase12_steps',
            'phase13_steps',
            'phase14_steps',
            'phase15_steps',
            'phase16_steps',
            'phase17_steps',
            'phase18_steps',
            'phase19_steps',
            'phase20_steps',
            'phase21_steps',
            'phase22_steps',
            'phase23_steps',
            'phase24_steps',
            'phase25_steps',
            'phase26_steps',
            'phase27_steps',
            'phase28_steps',
            'phase29_steps',
            'phase30_steps',
            'phase31_steps',
            'phase32_steps',
            'phase33_steps',
            'phase34_steps',
            'phase35_steps',
            'phase36_steps',
            'phase37_steps',
            'phase38_steps',
            'phase39_steps',
            'phase40_steps',
            'phase41_steps',
            'phase42_steps',
            'phase43_steps',
            'phase44_steps',
            'phase45_steps',
            'phase46_steps',
            'phase47_steps',
            'phase48_steps',
            'phase49_steps',
            'phase50_steps',
            'phase51_steps',
            'phase52_steps',
            'phase53_steps',
            'phase54_steps',
            'phase55_steps',
            'phase56_steps',
            'phase57_steps',
            'phase58_steps',
            'phase59_steps',
            'phase60_steps',
            'phase61_steps',
            'phase62_steps',
            'phase63_steps',
            'phase64_steps',
            'phase65_steps',
            'phase66_steps',
            'phase67_steps',
            'phase68_steps',
            'phase69_steps',
            'phase70_steps',
            'phase71_steps',
            'phase72_steps',
            'phase73_steps',
            'phase74_steps',
            'phase75_steps',
            'phase76_steps',
            'phase77_steps',
            'phase78_steps',
            'phase79_steps',
            'phase80_steps',
            'phase81_steps',
            'phase82_steps',
            'phase83_steps',
            'phase84_steps',
            'phase85_steps',
            'phase86_steps',
            'phase87_steps',
            'phase88_steps',
            'phase89_steps',
            'phase90_steps',
            'phase91_steps',
            'phase92_steps',
            'phase93_steps',
            'phase94_steps',
            'phase95_steps',
            'phase96_steps',
            'phase97_steps',
            'phase98_steps',
            'phase99_steps',
            'phase100_steps',
            'phase101_steps',
            'phase102_steps',
            'phase103_steps',
            'phase104_steps',
            'phase105_steps',
            'phase106_steps',
            'phase107_steps',
            'phase108_steps',
            'phase109_steps',
            'phase110_steps',
            'phase111_steps',
            'phase112_steps',
            'phase113_steps',
            'phase114_steps',
            'phase115_steps',
            'phase116_steps',
            'phase117_steps',
            'phase118_steps',
            'phase119_steps',
            'phase120_steps',
            'phase121_steps',
            'phase122_steps',
            'phase123_steps',
            'phase124_steps',
            'phase125_steps',
            'phase126_steps',
            'phase127_steps',
            'phase128_steps',
            'phase129_steps',
            'phase130_steps',
            'phase131_steps',
            'phase132_steps',
            'phase133_steps',
            'phase134_steps',
            'phase135_steps',
            'phase136_steps',
            'phase137_steps',
            'phase138_steps',
            'phase139_steps',
            'phase140_steps',
            'phase141_steps',
            'phase142_steps',
            'phase143_steps',
            'phase144_steps',
            'phase145_steps',
            'phase146_steps',
            'phase147_steps',
            'phase148_steps',
            'phase149_steps',
            'phase150_steps',
            'phase151_steps',
            'phase152_steps',
            'phase153_steps',
            'phase154_steps',
            'phase155_steps',
            'phase156_steps',
            'phase157_steps',
            'phase158_steps',
            'phase159_steps',
            'phase160_steps',
            'phase161_steps',
            'phase162_steps',
            'phase163_steps',
            'phase164_steps',
            'phase165_steps',
            'phase166_steps',
            'phase167_steps',
            'phase168_steps',
            'phase169_steps',
            'phase170_steps',
            'phase171_steps',
            'phase172_steps',
            'phase173_steps',
            'phase174_steps',
            'phase175_steps',
            'phase176_steps',
            'phase177_steps',
            'phase178_steps',
            'phase179_steps',
            'phase180_steps',
            'phase181_steps',
            'phase182_steps',
            'phase183_steps',
            'phase184_steps',
            'phase185_steps',
            'phase186_steps',
            'phase187_steps',
            'phase188_steps',
            'phase189_steps',
            'phase190_steps',
            'phase191_steps',
            'phase192_steps',
            'phase193_steps',
            'phase194_steps',
            'phase195_steps',
            'phase196_steps',
            'phase197_steps',
            'phase198_steps',
            'phase199_steps',
            'phase200_steps',
            'phase201_steps',
            'phase202_steps',
            'phase203_steps',
            'phase204_steps',
            'phase205_steps',
            'phase206_steps',
            'phase207_steps',
            'phase208_steps',
            'phase209_steps',
            'phase210_steps',
            'phase211_steps',
            'phase212_steps',
            'phase213_steps',
            'phase214_steps',
            'phase215_steps',
            'phase216_steps',
            'phase217_steps',
            'phase218_steps',
            'phase219_steps',
            'phase220_steps',
            'phase221_steps',
            'phase222_steps',
            'phase223_steps',
            'phase224_steps',
            'phase225_steps',
            'phase226_steps',
            'phase227_steps',
            'phase228_steps',
            'phase229_steps',
            'phase230_steps',
            'phase231_steps',
            'phase232_steps',
            'phase233_steps',
            'phase234_steps',
            'phase235_steps',
            'phase236_steps',
            'phase237_steps',
            'phase238_steps',
            'phase239_steps',
            'phase240_steps',
            'phase241_steps',
            'phase242_steps',
            'phase243_steps',
            'phase244_steps',
            'phase245_steps',
            'phase246_steps',
            'phase247_steps',
            'phase248_steps',
            'phase249_steps',
            'phase250_steps',
            'phase251_steps',
            'phase252_steps',
            'phase253_steps',
            'phase254_steps',
            'phase255_steps',
            'phase256_steps',
            'phase257_steps',
            'phase258_steps',
            'phase259_steps',
            'phase260_steps',
            'phase261_steps',
            'phase262_steps',
            'phase263_steps',
            'phase264_steps',
            'phase265_steps',
            'phase266_steps',
            'phase267_steps',
            'phase268_steps',
            'phase269_steps',
            'phase270_steps',
            'phase271_steps',
            'phase272_steps',
            'phase273_steps',
            'phase274_steps',
            'phase275_steps',
            'phase276_steps',
            'phase277_steps',
            'phase278_steps',
            'phase279_steps',
            'phase280_steps',
            'phase281_steps',
            'phase282_steps',
            'phase283_steps',
            'phase284_steps',
            'phase285_steps',
            'phase286_steps',
            'phase287_steps',
            'phase288_steps',
            'phase289_steps',
            'phase290_steps',
            'phase291_steps',
            'phase292_steps',
            'phase293_steps',
            'phase294_steps',
            'phase295_steps',
            'phase296_steps',
            'phase297_steps',
            'phase298_steps',
            'phase299_steps',
            'phase300_steps',
            'phase301_steps',
            'phase302_steps',
            'phase303_steps',
            'phase304_steps',
            'phase305_steps',
            'phase306_steps',
            'phase307_steps',
            'phase308_steps',
            'phase309_steps',
            'phase310_steps',
            'phase311_steps',
            'phase312_steps',
            'phase313_steps',
            'phase314_steps',
            'phase315_steps',
            'phase316_steps',
            'phase317_steps',
            'phase318_steps',
            'phase319_steps',
            'phase320_steps',
            'phase321_steps',
            'phase322_steps',
            'phase323_steps',
            'phase324_steps',
            'phase325_steps',
            'phase326_steps',
            'phase327_steps',
            'phase328_steps',
            'phase329_steps',
            'phase330_steps',
            'phase331_steps',
            'phase332_steps',
            'phase333_steps',
            'phase334_steps',
            'phase335_steps',
            'phase336_steps',
            'phase337_steps',
            'phase338_steps',
            'phase339_steps',
            'phase340_steps',
            'phase341_steps',
            'phase342_steps',
            'phase343_steps',
            'phase344_steps',
            'phase345_steps',
            'phase346_steps',
            'phase347_steps',
            'phase348_steps',
            'phase349_steps',
            'phase350_steps',
            'phase351_steps',
            'phase352_steps',
            'phase353_steps',
            'phase354_steps',
            'phase355_steps',
            'phase356_steps',
            'phase357_steps',
            'phase358_steps',
            'phase359_steps',
            'phase360_steps',
            'phase361_steps',
            'phase362_steps',
            'phase363_steps',
            'phase364_steps',
            'phase365_steps',
            'phase366_steps',
            'phase367_steps',
            'phase368_steps',
            'phase369_steps',
            'phase370_steps',
            'phase371_steps',
            'phase372_steps',
            'phase373_steps',
            'phase374_steps',
            'phase375_steps',
            'phase376_steps',
            'phase377_steps',
            'phase378_steps',
            'phase379_steps',
            'phase380_steps',
            'phase381_steps',
            'phase382_steps',
            'phase383_steps',
            'phase384_steps',
            'phase385_steps',
            'phase386_steps',
            'phase387_steps',
            'phase388_steps',
            'phase389_steps',
            'phase390_steps',
            'phase391_steps',
            'phase392_steps',
            'phase393_steps',
            'phase394_steps',
            'phase395_steps',
            'phase396_steps',
            'phase397_steps',
            'phase398_steps',
            'phase399_steps',
            'phase400_steps',
            'phase401_steps',
            'phase402_steps',
            'phase403_steps',
            'phase404_steps',
            'phase405_steps',
            'phase406_steps',
            'phase407_steps',
            'phase408_steps',
            'phase409_steps',
            'phase410_steps',
            'phase411_steps',
            'phase412_steps',
            'phase413_steps',
            'phase414_steps',
            'phase415_steps',
            'phase416_steps',
            'phase417_steps',
            'phase418_steps',
            'phase419_steps',
            'phase420_steps',
            'phase421_steps',
            'phase422_steps',
            'phase423_steps',
            'phase424_steps',
            'phase425_steps',
            'phase426_steps',
            'phase427_steps',
            'phase428_steps',
            'phase429_steps',
            'phase430_steps',
            'phase431_steps',
            'phase432_steps',
            'phase433_steps',
            'phase434_steps',
            'phase435_steps',
            'phase436_steps',
            'phase437_steps',
            'phase438_steps',
            'phase439_steps',
            'phase440_steps',
            'phase441_steps',
            'phase442_steps',
            'phase443_steps',
            'phase444_steps',
            'phase445_steps',
            'phase446_steps',
            'phase447_steps',
            'phase448_steps',
            'phase449_steps',
            'phase450_steps',
            'phase451_steps',
            'phase452_steps',
            'phase453_steps',
            'phase454_steps',
            'phase455_steps',
            'phase456_steps',
            'phase457_steps',
            'phase458_steps',
            'phase459_steps',
            'phase460_steps',
            'phase461_steps',
            'phase462_steps',
            'phase463_steps',
            'phase464_steps',
            'phase465_steps',
            'phase466_steps',
            'phase467_steps',
            'phase468_steps',
            'phase469_steps',
            'phase470_steps',
            'phase471_steps',
            'phase472_steps',
            'phase473_steps',
            'phase474_steps',
            'phase475_steps',
            'phase476_steps',
            'phase477_steps',
            'phase478_steps',
            'phase479_steps',
            'phase480_steps',
            'phase481_steps',
            'phase482_steps',
            'phase483_steps',
            'phase484_steps',
            'phase485_steps',
            'phase486_steps',
            'phase487_steps',
            'phase488_steps',
            'phase489_steps',
            'phase490_steps',
            'phase491_steps',
            'phase492_steps',
            'phase493_steps',
            'phase494_steps',
            'phase495_steps',
            'phase496_steps',
            'phase497_steps',
            'phase498_steps',
            'phase499_steps',
            'phase500_steps'
        ]
        
        for noisy_logger in noisy_loggers:
            try:
                logging.getLogger(noisy_logger).setLevel(logging.WARNING)
            except:
                pass  # Logger might not exist yet
    
    return verbose_mode


def get_uvicorn_log_level():
    """Get appropriate log level for uvicorn based on verbosity."""
    verbose_mode = os.getenv("ALWRITY_VERBOSE", "false").lower() == "true"
    return "debug" if verbose_mode else "info"
